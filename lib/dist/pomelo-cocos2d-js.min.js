!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d;!function(){d=this}();var e=a("events").EventEmitter;d.EventEmitter=e;var f=a("pomelo-protobuf");d.protobuf=f;var g=a("pomelo-protocol");d.Protocol=g;var h=a("pomelo-jsclient-websocket");d.pomelo=h;var i=a("browser-http");d.browser_http=i},{"browser-http":12,events:26,"pomelo-jsclient-websocket":27,"pomelo-protobuf":33,"pomelo-protocol":35}],2:[function(a,b,c){function d(){this.error=!1,this.sent=!1,this.requestHeaders={},this.responseHeaders={}}function e(a){a&&(this.handle=a)}d.prototype={statusReasons:{100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported",507:"Insufficient Storage"},UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,readyState:0,open:function(a,b,c,d,e){if("string"!=typeof a)throw"INVALID_METHOD";switch(a.toUpperCase()){case"CONNECT":case"TRACE":case"TRACK":throw"SECURITY_ERR";case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"POST":case"PUT":a=a.toUpperCase()}if(this.method=a,"string"!=typeof b)throw"INVALID_URL";this.url=b,this.urlParts=this.parseUri(b),void 0===c&&(c=!0),this.async=c,this.user=d,this.password=e,this.readyState=this.OPENED,this.onreadystatechange()},setRequestHeader:function(a,b){switch(a=a.toLowerCase()){case"accept-charset":case"accept-encoding":case"connection":case"content-length":case"cookie":case"cookie2":case"content-transfer-encoding":case"date":case"expect":case"host":case"keep-alive":case"referer":case"te":case"trailer":case"transfer-encoding":case"upgrade":case"user-agent":case"via":return}if("proxy-"!==a.substr(0,6)&&"sec-"!==a.substr(0,4))if(void 0===this.requestHeaders[a])this.requestHeaders[a]=b;else{var c=this.requestHeaders[a];this.requestHeaders[a]=c+", "+b}},send:function(a){if(this.readyState!==this.OPENED||this.sent)throw"INVALID_STATE_ERR";("GET"===this.method||"HEAD"===this.method)&&(a=null),this.error=!1,this.sent=!0,this.onreadystatechange(),this.requestText=a,this.onsend()},abort:function(){this.responseText=null,this.error=!0;for(var a in this.requestHeaders)delete this.requestHeaders[a];delete this.requestText,this.onreadystatechange(),this.onabort(),this.readyState=this.UNSENT},status:0,statusText:"",getResponseHeader:function(a){return this.readyState===this.UNSENT||this.readyState===this.OPENED||this.error?null:this.responseHeaders[a.toLowerCase()]},getAllResponseHeaders:function(){var a="";for(var b in this.responseHeaders)"set-cookie"!==b&&"set-cookie2"!==b&&(a+=b+": "+this.responseHeaders[b]+"\r\n");return a},responseText:"",responseXML:void 0,onload:function(){},onprogress:function(){},onerror:function(){},onabort:function(){},onreadystatechange:function(){},onsend:function(){},getRequestHeader:function(a){return this.requestHeaders[a.toLowerCase()]},setResponseHeader:function(a,b){this.responseHeaders[a.toLowerCase()]=b},makeXMLResponse:function(a){var b,c=this.getResponseHeader("Content-Type");if(c=c&&c.split(";",1)[0],null==c||"text/xml"==c||"application/xml"==c||c&&"+xml"==c.substring(c.length-4)){try{if(window.DOMParser){var d=new DOMParser;b=d.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)}catch(e){b=null}(b&&b.parseError&&0!=b.parseError.errorCode||b&&b.documentElement&&"parsererror"==b.documentElement.nodeName||b&&b.documentElement&&"html"==b.documentElement.nodeName&&b.documentElement.firstChild&&"body"==b.documentElement.firstChild.nodeName&&b.documentElement.firstChild.firstChild&&"parsererror"==b.documentElement.firstChild.firstChild.nodeName)&&(b=null)}else b=null;return b},receive:function(a,b,c){if(this.readyState!==this.OPENED||!this.sent)throw"INVALID_STATE_ERR";this.status=a,this.statusText=a+" "+this.statusReasons[a],this.readyState=this.HEADERS_RECEIVED,this.onprogress(),this.onreadystatechange(),this.responseText=b,this.responseXML=this.makeXMLResponse(b),this.readyState=this.LOADING,this.onprogress(),this.onreadystatechange();var d=this,e=function(){d.readyState=d.DONE,d.onreadystatechange(),d.onprogress(),d.onload()};if(null===c)e();else{if("number"!=typeof c&&("object"!=typeof c||"number"!=typeof c.min||"number"!=typeof c.max))throw new Error("Invalid type of timeout.");"object"==typeof c&&(c=Math.floor(Math.random()*(c.max-c.min+1))+c.min),setTimeout(function(){e()},c)}},err:function(a){if(this.readyState!==this.OPENED||!this.sent)throw"INVALID_STATE_ERR";this.responseText=null,this.error=!0;for(var b in this.requestHeaders)delete this.requestHeaders[b];if(this.readyState=this.DONE,!this.async)throw a;this.onreadystatechange(),this.onerror()},authenticate:function(a,b){if(this.user)return a===this.user&&b===this.password;if(this.urlParts.user)return a===this.urlParts.user&&b===this.urlParts.password;var c=this.getRequestHeader("Authorization");if(void 0===c)return!1;if("Basic "!==c.substr(0,6))return!1;if("function"!=typeof atob)return!1;c=atob(c.substr(6));var d=c.split(":"),e=d.shift(),f=d.join(":");return a===e&&b===f},parseUri:function(a){for(var b=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,c=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],d=/(?:^|&)([^&=]*)=?([^&]*)/g,e=b.exec(a),f={},g=14;g--;)f[c[g]]=e[g]||"";return f.queryKey={},f[c[12]].replace(d,function(a,b,c){b&&(f.queryKey[b]=c)}),f}},e.prototype={start:function(){function a(){this.onsend=function(){b.handle(this)},d.apply(this,arguments)}var b=this;a.prototype=d.prototype,window.OriginalHttpRequest=window.XMLHttpRequest,window.XMLHttpRequest=a},stop:function(){window.XMLHttpRequest=window.OriginalHttpRequest},handle:function(a){}},b.exports=d},{}],3:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;d=a("events").EventEmitter,c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.http=null,b.prototype.setHttp=function(a){return this.http=a,this.emit("httpReady",this.http)},b}(d),b.exports=c}).call(this)},{events:26}],4:[function(a,b,c){(function(){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("./BaseExtension"),c=null,e=function(a){function b(a){this.onFormSubmitted=f(this.onFormSubmitted,this),c=a,c(document).on("submit."+b.EVENTS_NAMESPACE,"form.ajax:not(.not-ajax)",this.onFormSubmitted),c(document).on("click."+b.EVENTS_NAMESPACE,'form.ajax:not(.not-ajax) input[type="submit"]',this.onFormSubmitted),c(document).on("click."+b.EVENTS_NAMESPACE,'form input[type="submit"].ajax',this.onFormSubmitted)}return g(b,a),b.EVENTS_NAMESPACE="http-ext-forms",b.prototype.onFormSubmitted=function(a){var b,d,e,f,g,h,i,j,k,l,m,n;if(a.preventDefault(),null===this.http)throw new Error("Please add Forms extension into http object with addExtension method.");if(d=c(a.target),k={},d.is(":submit"))e=d.closest("form"),k[d.attr("name")]=d.val()||"";else{if(!d.is("form"))return null;e=d}if(e.get(0).onsubmit&&e.get(0).onsubmit()===!1)return null;for(n=e.serializeArray(),f=g=0,h=n.length;h>g;f=++g)m=n[f],i=m.name,"undefined"==typeof k[i]?k[i]=m.value:(l=k[i],"[object Array]"!==Object.prototype.toString.call(l)&&(l=[l]),l.push(m.value),k[i]=l);return j={data:k,type:e.attr("method")||"GET"},b=e.attr("action")||window.location.href,this.http.request(b,j)},b.prototype.detach=function(){return c(document).off("."+b.EVENTS_NAMESPACE)},b}(d),b.exports=e}).call(this)},{"./BaseExtension":3}],5:[function(a,b,c){(function(){var c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("./BaseExtension"),c=null,f=function(a,b){var d;return d=c(a).attr(b),"undefined"!=typeof d&&d!==!1},e=function(a){function b(a){c=a,c(document).on("click."+b.EVENT_NAMESPACE,"a.ajax:not(.not-ajax)",function(a){return function(d){var e,g,h;if(d.preventDefault(),null===a.http)throw new Error("Please add Links extension into http object with addExtension method.");return e="a"===d.target.nodeName.toLowerCase()?c(d.target):c(d.target).closest("a"),g=e.attr("href"),h=f(e,"data-type")?e.attr("data-type").toUpperCase():"GET",a.http.isHistoryApiSupported()&&f(e,b.HISTORY_API_ATTRIBUTE)&&window.history.pushState({},null,g),a.http.request(g,{type:h})}}(this))}return g(b,a),b.HISTORY_API_ATTRIBUTE="data-history-api",b.EVENT_NAMESPACE="http-ext-links",b.prototype.detach=function(){return c(document).off("."+b.EVENT_NAMESPACE)},b}(d),b.exports=e}).call(this)},{"./BaseExtension":3}],6:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=a("./BaseExtension"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.send=function(){return document.body.style.cursor="progress"},b.prototype.complete=function(){return document.body.style.cursor="auto"},b}(c),b.exports=d}).call(this)},{"./BaseExtension":3}],7:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=a("./BaseExtension"),d=function(a){function b(a,b){null==a&&(a="favicon.ico"),null==b&&(b=5e3),this.start(a,b)}return e(b,a),b.HTTP_TYPE="HEAD",b.prototype.timer=null,b.prototype.offline=!1,b.prototype.start=function(a,c){return null==a&&(a="favicon.ico"),null==c&&(c=5e3),this.timer=window.setInterval(function(c){return function(){var d;if(null===c.http)throw new Error("Please add Offline extension into http object with addExtension method.");return d={type:b.HTTP_TYPE,data:{r:Math.floor(1e9*Math.random())}},c.http.request(a,d,function(a,b){if(b){if(!c.offline)return c.offline=!0,c.http.emit("disconnected")}else if(a.status>=200&&a.status<=300||304===a.status){if(c.offline)return c.offline=!1,c.http.emit("connected")}else if(!c.offline)return c.offline=!0,c.http.emit("disconnected")})}}(this),c)},b.prototype.stop=function(){return null!==this.timer&&(window.clearInterval(this.timer),this.timer=null),this},b}(c),b.exports=d}).call(this)},{"./BaseExtension":3}],8:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=a("./BaseExtension"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.success=function(a){return null!==a.data&&"undefined"!=typeof a.data.redirect?window.location.href=a.data.redirect:void 0},b}(c),b.exports=d}).call(this)},{"./BaseExtension":3}],9:[function(a,b,c){(function(){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;c=a("./BaseExtension"),e=function(a,b){var c;return c=a.getAttribute(b),null!==c&&"undefined"!=typeof c&&c!==!1},d=function(a){function b(){return this.success=f(this.success,this),b.__super__.constructor.apply(this,arguments)}return g(b,a),b.APPEND_ATTRIBUTE="data-append",b.prototype.success=function(a){var c,d,f,g,h;if(null!==a.data&&"undefined"!=typeof a.data.snippets){g=a.data.snippets,h=[];for(f in g)d=g[f],c=document.getElementById(f),h.push(e(c,b.APPEND_ATTRIBUTE)?this.appendSnippet(c,d):this.updateSnippet(c,d));return h}},b.prototype.updateSnippet=function(a,b){return a.innerHTML=b},b.prototype.appendSnippet=function(a,b){return a.innerHTML+=b},b}(c),b.exports=d}).call(this)},{"./BaseExtension":3}],10:[function(a,b,c){(function(){var a;a=function(){function a(){}return a.prototype._error=function(){throw new Error("Please, use callbacks instead of promise pattern.")},a.prototype.then=function(){return this._error()},a.prototype["catch"]=function(){return this._error()},a.prototype.fail=function(){return this._error()},a.prototype.done=function(){return this._error()},a}(),b.exports=a}).call(this)},{}],11:[function(a,b,c){(function(){var a;a=function(){function a(){}return a.urlencode=function(a){return a=(a+"").toString(),encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/\~/g,"%7E").replace(/%20/g,"+")},a.buildQuery=function(a){var b,c,d,e,f,g,h;if(g=[],b=function(a,b){return b="function"==typeof b?b():null===b?"":b,g.push(encodeURIComponent(a)+"="+encodeURIComponent(b))},c=function(a,d){var e,f,g,h,i,j,k;if("[object Array]"===Object.prototype.toString.call(d)){for(i=[],e=f=0,h=d.length;h>f;e=++f)k=d[e],i.push(/\[\]$/.test(a)===!0?b(a,k):c(a+"["+("object"==typeof k?e:"")+"]",k));return i}if("[object Object]"===Object.prototype.toString.call(d)){j=[];for(g in d)k=d[g],j.push(c(a+"["+g+"]",k));return j}return b(a,d)},"[object Array]"===Object.prototype.toString.call(a))for(e=d=0,f=a.length;f>d;e=++d)h=a[e],b(e,h);else for(e in a)h=a[e],c(e,h);return g.join("&").replace(/%20/g,"+")},a}(),b.exports=a}).call(this)},{}],12:[function(a,b,c){(function(){var c,d,e;c=a("./_Http"),d=function(){var b;return b=new c,b.Helpers=a("./Helpers"),b.Xhr=a("./Xhr"),b.Extensions={Forms:a("./Extensions/Forms"),Links:a("./Extensions/Links"),Loading:a("./Extensions/Loading"),Redirect:a("./Extensions/Redirect"),Snippets:a("./Extensions/Snippets"),Offline:a("./Extensions/Offline")},b.Mocks={Http:a("./Mocks/Http")},b},e=d(),e.createInstance=d,b.exports=e}).call(this)},{"./Extensions/Forms":4,"./Extensions/Links":5,"./Extensions/Loading":6,"./Extensions/Offline":7,"./Extensions/Redirect":8,"./Extensions/Snippets":9,"./Helpers":11,"./Mocks/Http":13,"./Xhr":19,"./_Http":20}],13:[function(a,b,c){(function(){var c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./Request"),d=a("../_Http"),f=function(a,b,c,d,f,g,h,i,j){var k,l;return null==h&&(h={}),null==i&&(i=200),null==j&&(j=null),"undefined"==typeof h["content-type"]&&(h["content-type"]="text/plain"),null===h["content-type"].match(/application\/json/)&&null===this.jsonPrefix||"[object Array]"!==(k=Object.prototype.toString.call(g))&&"[object Object]"!==k||(g=JSON.stringify(g)),l=new e(a,b,c,d,f),l.on("afterSend",function(){var a,b;for(a in h)b=h[a],l.xhr.setResponseHeader(a,b);return l.xhr.receive(i,g,j)}),l},c=function(a){function b(){b.__super__.constructor.apply(this,arguments),this._originalCreateRequest=this.createRequest}return g(b,a),b.prototype._originalCreateRequest=null,b.prototype.receive=function(a,b,c,d){return null==a&&(a=""),null==b&&(b={}),null==c&&(c=200),null==d&&(d=null),this.createRequest=function(e,g,h,i,j){return f(e,g,h,i,j,a,b,c,d)}},b.prototype.receiveDataFromRequestAndSendBack=function(a,b,c){return null==a&&(a={}),null==b&&(b=200),null==c&&(c=null),this.createRequest=function(d,e,g,h,i){return f(d,e,g,h,i,g,a,b,c)}},b.prototype.receiveError=function(a){return this.createRequest=function(b,c,d,f,g){var h;return h=new e(b,c,d,f,g),h.on("afterSend",function(){return h.xhr.receiveError(a)}),h}},b.prototype.restore=function(){return this.createRequest=this._originalCreateRequest},b}(d),b.exports=c}).call(this)},{"../_Http":20,"./Request":14}],14:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;c=a("../Request"),e=a("./Xhr"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.createXhr=function(a,b,c,d,f){return new e(a,b,c,d,f)},b}(c),b.exports=d}).call(this)},{"../Request":17,"./Xhr":15}],15:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;c=a("../Xhr"),e=a("../../external/XmlHttpRequest"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.createXhr=function(){return new e},b.prototype.receive=function(a,b,c){return null==c&&(c=null),this.xhr.receive(a,b,c)},b.prototype.receiveError=function(a){return this.xhr.err(a)},b.prototype.setResponseHeader=function(a,b){return this.xhr.setResponseHeader(a,b)},b}(c),b.exports=d}).call(this)},{"../../external/XmlHttpRequest":2,"../Xhr":19}],16:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;c=a("events").EventEmitter,d=a("./FakePromise"),e=function(a){function b(){this.requests=[]}return f(b,a),b.prototype.requests=null,b.prototype.running=!1,b.prototype.hasWritableRequests=function(){var a,b,c,d,e;if(this.running)for(c=this.requests,a=0,b=c.length;b>a;a++)if(e=c[a],"PUT"===(d=e.request.type)||"POST"===d||"DELETE"===d)return!0;return!1},b.prototype.getCurrentRequest=function(){return 0===this.requests.length?null:this.requests[0].request},b.prototype.addAndSend=function(a,b){return this.emit("add",a),this.requests.push({request:a,fn:b}),this.running||this.run(),new d},b.prototype.next=function(){return this.requests.shift(),this.requests.length>0?(this.emit("next",this.requests[0].request),this.run()):(this.running=!1,this.emit("finish"))},b.prototype.run=function(){var a,b,c;if(0===this.requests.length)throw new Error("No pending requests");return this.running=!0,a=this.requests[0],c=a.request,b=a.fn,this.emit("send",c),c.send(function(a){return function(c,d){return b(c,d),a.next()}}(this))},b.prototype.removePending=function(){var a;return this.running?(a=this.requests[0],this.requests=[a]):this.requests=[],this},b.prototype.stop=function(){return this.running&&this.getCurrentRequest().abort(),this.requests=[],this},b}(c),b.exports=e}).call(this)},{"./FakePromise":10,events:26}],17:[function(a,b,c){(function(){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("./Xhr"),c=a("events").EventEmitter,d=function(a){function b(a,c,d,e,f){var g;if(this.url=a,this.type=null!=c?c:"GET",this.data=null!=d?d:null,this.jsonp=null!=e?e:!1,this.jsonPrefix=null!=f?f:null,b.__super__.constructor.apply(this,arguments),this.type=this.type.toUpperCase(),"GET"!==(g=this.type)&&"POST"!==g&&"PUT"!==g&&"DELETE"!==g&&"HEAD"!==g&&"CONNECT"!==g&&"OPTIONS"!==g&&"TRACE"!==g)throw new Error("Http request: type must be GET, POST, PUT, DELETE, HEAD, CONNECT, OPTIONS or TRACE, "+this.type+" given");this.xhr=this.createXhr(this.url,this.type,this.data,this.jsonp,this.jsonPrefix),this.response=this.xhr.response,this.xhr.on("send",function(a){return function(b){return a.emit("send",b,a)}}(this)),this.xhr.on("afterSend",function(a){return function(b){return a.emit("afterSend",b,a)}}(this)),this.xhr.on("success",function(a){return function(b){return a.emit("success",b,a)}}(this)),this.xhr.on("error",function(a){return function(b,c){return a.emit("error",b,c,a)}}(this)),this.xhr.on("complete",function(a){return function(b,c){return a.emit("complete",b,c,a)}}(this)),this.xhr.on("abort",function(a){return function(b){return a.emit("abort",b)}}(this))}return f(b,a),b.prototype.url=null,b.prototype.type="GET",b.prototype.data=null,b.prototype.jsonp=null,b.prototype.xhr=null,b.prototype.response=null,b.prototype.jsonPrefix=null,b.prototype.aborted=!1,b.prototype.createXhr=function(a,b,c,d,f){return new e(a,b,c,d,f)},b.prototype.setHeader=function(a,b){return this.xhr.setHeader(a,b)},b.prototype.send=function(a){return this.xhr.send(a)},b.prototype.abort=function(){return this.xhr.abort()},b.prototype.getHeaders=function(){return this.xhr.getHeaders()},b.prototype.getHeader=function(a){return this.xhr.getHeader(a)},b.prototype.setHeader=function(a,b){return this.xhr.setHeader(a,b)},b.prototype.setMimeType=function(a){return this.xhr.setMimeType(a)},b}(c),b.exports=d}).call(this)},{"./Xhr":19,events:26}],18:[function(a,b,c){(function(){var a;a=function(){function a(){}return a.prototype.state=0,a.prototype.status=null,a.prototype.statusText=null,a.prototype.rawData=null,a.prototype.data=null,a.prototype.xml=null,a.prototype.error=null,a}(),b.exports=a}).call(this)},{}],19:[function(require,module,exports){(function(){var EventEmitter,FakePromise,Helpers,Response,Xhr,escape,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Helpers=require("./Helpers"),Response=require("./Response"),FakePromise=require("./FakePromise"),EventEmitter=require("events").EventEmitter,escape=require("escape-regexp"),Xhr=function(superClass){function Xhr(url,type,data1,jsonp,jsonPrefix){var method;this.url=url,this.type=null!=type?type:"GET",this.data=null!=data1?data1:null,this.jsonp=null!=jsonp?jsonp:!1,this.jsonPrefix=null!=jsonPrefix?jsonPrefix:null,this.response=new Response,Xhr.COUNTER++,this.jsonp!==!1&&(this.jsonp===!0&&(this.jsonp="callback"),method=Xhr.JSONP_METHOD_PREFIX+Xhr.COUNTER,this.url+=-1!==this.url.indexOf("?")?"&":"?",this.url+=this.jsonp+"="+method,window[method]=function(a){return function(b){return a.response.data=b}}(this)),null!==this.data&&(this.data=Helpers.buildQuery(this.data),"POST"!==this.type&&(this.url+=-1!==this.url.indexOf("?")?"&":"?",this.url+=this.data)),this.xhr=this.createXhr(),this.xhr.open(this.type,this.url,!0),null===this.url.match(/^(http)s?\:\/\//)&&this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===this.type&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.onreadystatechange=function(_this){return function(){var contentType,data,error,isSuccess,prefix;return _this.response.state=_this.xhr.readyState,4===_this.response.state?(_this.response.status=_this.xhr.status,isSuccess=_this.response.status>=200&&_this.response.status<300||304===_this.response.status,isSuccess?(204===_this.response.status||"HEAD"===_this.type?_this.response.statusText="nocontent":304===_this.response.status?_this.response.statusText="notmodified":(_this.response.statusText=_this.xhr.statusText,_this.response.rawData=_this.xhr.responseText,_this.response.xml=_this.xhr.responseXML,_this.response.data=_this.xhr.responseText,contentType=_this.xhr.getResponseHeader("content-type"),null===contentType||null===contentType.match(/application\/json/)&&null===_this.jsonPrefix||(data=_this.response.data,null!==_this.jsonPrefix&&(prefix=escape(_this.jsonPrefix),data=data.replace(new RegExp("^"+prefix),"")),_this.response.data=JSON.parse(data)),null===contentType||null===contentType.match(/text\/javascript/)&&null===contentType.match(/application\/javascript/)||!_this.jsonp||eval(_this.response.data)),_this.emit("success",_this.response)):(_this.response.statusText=_this.xhr.statusText,error=new Error("Can not load "+_this.url+" address"),error.response=_this.response,_this.emit("error",error,_this.response))):void 0}}(this)}return extend(Xhr,superClass),Xhr.JSONP_METHOD_PREFIX="__browser_http_jsonp_callback_",Xhr.COUNTER=0,Xhr.prototype.xhr=null,Xhr.prototype.response=null,Xhr.prototype.url=null,Xhr.prototype.type="GET",Xhr.prototype.data=null,Xhr.prototype.jsonp=!1,Xhr.prototype.jsonPrefix=null,Xhr.prototype.createXhr=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},Xhr.prototype.getHeaders=function(){return this.xhr.getAllResponseHeaders()},Xhr.prototype.getHeader=function(a){return this.xhr.getResponseHeader(a)},Xhr.prototype.setHeader=function(a,b){return this.xhr.setRequestHeader(a,b),this},Xhr.prototype.setMimeType=function(a){return this.xhr.overrideMimeType(a),this},Xhr.prototype.send=function(a){return this.emit("send",this.response),this.on("success",function(b){return function(c){return b.emit("complete",null,c),a(c,null)}}(this)),this.on("error",function(b){return function(c,d){return b.emit("complete",c,d),a(null,c)}}(this)),this.xhr.send(this.data),this.emit("afterSend",this.response),new FakePromise},Xhr.prototype.abort=function(){return this.xhr.abort(),this.emit("abort",this.response),this},Xhr}(EventEmitter),module.exports=Xhr}).call(this)},{"./FakePromise":10,"./Helpers":11,"./Response":18,"escape-regexp":21,events:26}],20:[function(a,b,c){(function(){var c,d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty,j=[].slice;g=a("./Request"),f=a("./Queue"),c=a("./Extensions/BaseExtension"),d=a("events").EventEmitter,e=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.extensions={},this.queue=new f,this.on("send",function(a){return function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],a.callExtensions("send",b)}}(this)),this.on("afterSend",function(a){return function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],a.callExtensions("afterSend",b)}}(this)),this.on("complete",function(a){return function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],a.callExtensions("complete",b)}}(this)),this.on("error",function(a){return function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],a.callExtensions("error",b)}}(this)),this.on("success",function(a){return function(){var b;return b=1<=arguments.length?j.call(arguments,0):[],a.callExtensions("success",b)}}(this))}return h(b,a),b.prototype.extensions=null,b.prototype.queue=null,b.prototype.historyApiSupported=null,b.prototype.useQueue=!0,b.prototype.options={type:"GET",jsonPrefix:null,parallel:!0},b.prototype.createRequest=function(a,b,c,d,e){return new g(a,b,c,d,e)},b.prototype.request=function(a,b,c){var d,e,f,g;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),a=d.url,e=d.options,c=d.fn,"undefined"==typeof e.type&&(e.type=this.options.type),"undefined"==typeof e.data&&(e.data=null),"undefined"==typeof e.jsonp&&(e.jsonp=!1),"undefined"==typeof e.jsonPrefix&&(e.jsonPrefix=this.options.jsonPrefix),"undefined"==typeof e.parallel&&(e.parallel=this.options.parallel),g=this.createRequest(a,e.type,e.data,e.jsonp,e.jsonPrefix),g.on("send",function(a){return function(b,c){return a.emit("send",b,c)}}(this)),g.on("afterSend",function(a){return function(b,c){return a.emit("afterSend",b,c)}}(this)),g.on("success",function(a){return function(b,c){return a.emit("success",b,c)}}(this)),g.on("error",function(a){return function(b,c,d){return a.emit("error",b,c,d)}}(this)),g.on("complete",function(a){return function(b,c,d){return a.emit("complete",b,c,d)}}(this)),this.useQueue&&("PUT"===(f=e.type)||"POST"===f||"DELETE"===f||e.parallel===!1||this.queue.hasWritableRequests())?this.queue.addAndSend(g,c):g.send(c)},b.prototype.get=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),d.options.type="GET",this.request(d.url,d.options,d.fn)},b.prototype.post=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),d.options.type="POST",this.request(d.url,d.options,d.fn)},b.prototype.put=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),d.options.type="PUT",this.request(d.url,d.options,d.fn)},b.prototype["delete"]=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),d.options.type="DELETE",this.request(d.url,d.options,d.fn)},b.prototype.getJson=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),this.request(d.url,d.options,function(a,b){return b||"string"!=typeof a.data||(a.data=JSON.parse(a.data)),c(a,b)})},b.prototype.postJson=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),d.options.type="POST",this.request(d.url,d.options,function(a,b){return b||"string"!=typeof a.data||(a.data=JSON.parse(a.data)),c(a,b)})},b.prototype.jsonp=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),d=this._optimizeArguments(a,b,c),"undefined"==typeof d.options.jsonp&&(d.options.jsonp=!0),this.get(d.url,d.options,d.fn)},b.prototype.isHistoryApiSupported=function(){return this.historyApiSupported&&(this.historyApiSupported=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/)),this.historyApiSupported},b.prototype.addExtension=function(a,b){return b instanceof c&&b.setHttp(this),this.extensions[a]=b,this},b.prototype.removeExtension=function(a){if("undefined"==typeof this.extensions[a])throw new Error("Extension "+a+" does not exists");return delete this.extensions[a],this},b.prototype.callExtensions=function(a,b){var c,d,e,f;e=this.extensions,f=[];for(d in e)c=e[d],f.push("undefined"!=typeof c[a]?c[a].apply(c[a],b):void 0);return f},b.prototype._optimizeArguments=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c=null),"[object Function]"===Object.prototype.toString.call(b)?(c=b,d={}):d=b,null===c&&(c=function(){return{}}),{url:a,options:d,fn:c}},b}(d),b.exports=e}).call(this)},{"./Extensions/BaseExtension":3,"./Queue":16,"./Request":17,events:26}],21:[function(a,b,c){b.exports=function(a){return String(a).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}},{}],22:[function(a,b,c){function d(a){return this instanceof d?(this.length=0,this.parent=void 0,"number"==typeof a?e(this,a):"string"==typeof a?f(this,a,arguments.length>1?arguments[1]:"utf8"):g(this,a)):arguments.length>1?new d(a,arguments[1]):new d(a)}function e(a,b){if(a=m(a,0>b?0:0|n(b)),!d.TYPED_ARRAY_SUPPORT)for(var c=0;b>c;c++)a[c]=0;return a}function f(a,b,c){("string"!=typeof c||""===c)&&(c="utf8");var d=0|p(b,c);return a=m(a,d),a.write(b,c),a}function g(a,b){if(d.isBuffer(b))return h(a,b);
if(U(b))return i(a,b);if(null==b)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer?j(a,b):b.length?k(a,b):l(a,b)}function h(a,b){var c=0|n(b.length);return a=m(a,c),b.copy(a,0,0,c),a}function i(a,b){var c=0|n(b.length);a=m(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function j(a,b){var c=0|n(b.length);a=m(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function k(a,b){var c=0|n(b.length);a=m(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function l(a,b){var c,d=0;"Buffer"===b.type&&U(b.data)&&(c=b.data,d=0|n(c.length)),a=m(a,d);for(var e=0;d>e;e+=1)a[e]=255&c[e];return a}function m(a,b){d.TYPED_ARRAY_SUPPORT?a=d._augment(new Uint8Array(b)):(a.length=b,a._isBuffer=!0);var c=0!==b&&b<=d.poolSize>>>1;return c&&(a.parent=W),a}function n(a){if(a>=V)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+V.toString(16)+" bytes");return 0|a}function o(a,b){if(!(this instanceof o))return new o(a,b);var c=new d(a,b);return delete c.parent,c}function p(a,b){if("string"!=typeof a&&(a=String(a)),0===a.length)return 0;switch(b||"utf8"){case"ascii":case"binary":case"raw":return a.length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*a.length;case"hex":return a.length>>>1;case"utf8":case"utf-8":return M(a).length;case"base64":return P(a).length;default:return a.length}}function q(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function r(a,b,c,d){return Q(M(b,a.length-c),a,c,d)}function s(a,b,c,d){return Q(N(b),a,c,d)}function t(a,b,c,d){return s(a,b,c,d)}function u(a,b,c,d){return Q(P(b),a,c,d)}function v(a,b,c,d){return Q(O(b,a.length-c),a,c,d)}function w(a,b,c){return S.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function x(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=R(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+R(e)}function y(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(127&a[e]);return d}function z(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function A(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=L(a[f]);return e}function B(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function C(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function D(a,b,c,e,f,g){if(!d.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>f||g>b)throw new RangeError("value is out of bounds");if(c+e>a.length)throw new RangeError("index out of range")}function E(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function F(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function G(a,b,c,d,e,f){if(b>e||f>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(0>c)throw new RangeError("index out of range")}function H(a,b,c,d,e){return e||G(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),T.write(a,b,c,d,23,4),c+4}function I(a,b,c,d,e){return e||G(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),T.write(a,b,c,d,52,8),c+8}function J(a){if(a=K(a).replace(Y,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function K(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function L(a){return 16>a?"0"+a.toString(16):a.toString(16)}function M(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;g++){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=e-55296<<10|c-56320|65536,e=null}else e&&((b-=3)>-1&&f.push(239,191,189),e=null);if(128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(2097152>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function N(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function O(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function P(a){return S.toByteArray(J(a))}function Q(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function R(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}var S=a("base64-js"),T=a("ieee754"),U=a("is-array");c.Buffer=d,c.SlowBuffer=o,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var V=1073741823,W={};d.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);return b.foo=function(){return 42},42===b.foo()&&"function"==typeof b.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(c){return!1}}(),d.isBuffer=function(a){return!(null==a||!a._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,e=b.length,f=0,g=Math.min(c,e);g>f&&a[f]===b[f];)++f;return f!==g&&(c=a[f],e=b[f]),e>c?-1:c>e?1:0},d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(a,b){if(!U(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.byteLength=p,d.prototype.length=void 0,d.prototype.parent=void 0,d.prototype.toString=function(a,b,c){var d=!1;if(b=0|b,c=void 0===c||c===1/0?this.length:0|c,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return A(this,b,c);case"utf8":case"utf-8":return x(this,b,c);case"ascii":return y(this,b,c);case"binary":return z(this,b,c);case"base64":return w(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}},d.prototype.equals=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===d.compare(this,a)},d.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},d.prototype.compare=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:d.compare(this,a)},d.prototype.indexOf=function(a,b){function c(a,b,c){for(var d=-1,e=0;c+e<a.length;e++)if(a[c+e]===b[-1===d?0:e-d]){if(-1===d&&(d=e),e-d+1===b.length)return c+d}else d=-1;return-1}if(b>2147483647?b=2147483647:-2147483648>b&&(b=-2147483648),b>>=0,0===this.length)return-1;if(b>=this.length)return-1;if(0>b&&(b=Math.max(this.length+b,0)),"string"==typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(d.isBuffer(a))return c(this,a,b);if("number"==typeof a)return d.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer")},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b,b=0|c,c=e}var f=this.length-b;if((void 0===c||c>f)&&(c=f),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(var g=!1;;)switch(d){case"hex":return q(this,a,b,c);case"utf8":case"utf-8":return r(this,a,b,c);case"ascii":return s(this,a,b,c);case"binary":return t(this,a,b,c);case"base64":return u(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,a,b,c);default:if(g)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),g=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var e;if(d.TYPED_ARRAY_SUPPORT)e=d._augment(this.subarray(a,b));else{var f=b-a;e=new d(f,void 0);for(var g=0;f>g;g++)e[g]=this[g+a]}return e.length&&(e.parent=this.parent||this),e},d.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||C(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},d.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||C(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},d.prototype.readUInt8=function(a,b){return b||C(a,1,this.length),this[a]},d.prototype.readUInt16LE=function(a,b){return b||C(a,2,this.length),this[a]|this[a+1]<<8},d.prototype.readUInt16BE=function(a,b){return b||C(a,2,this.length),this[a]<<8|this[a+1]},d.prototype.readUInt32LE=function(a,b){return b||C(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},d.prototype.readUInt32BE=function(a,b){return b||C(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},d.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||C(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},d.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||C(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},d.prototype.readInt8=function(a,b){return b||C(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},d.prototype.readInt16LE=function(a,b){b||C(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt16BE=function(a,b){b||C(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt32LE=function(a,b){return b||C(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},d.prototype.readInt32BE=function(a,b){return b||C(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},d.prototype.readFloatLE=function(a,b){return b||C(a,4,this.length),T.read(this,a,!0,23,4)},d.prototype.readFloatBE=function(a,b){return b||C(a,4,this.length),T.read(this,a,!1,23,4)},d.prototype.readDoubleLE=function(a,b){return b||C(a,8,this.length),T.read(this,a,!0,52,8)},d.prototype.readDoubleBE=function(a,b){return b||C(a,8,this.length),T.read(this,a,!1,52,8)},d.prototype.writeUIntLE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||D(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},d.prototype.writeUIntBE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||D(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},d.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,1,255,0),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=a,b+1},d.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):E(this,a,b,!0),b+2},d.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):E(this,a,b,!1),b+2},d.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=a):F(this,a,b,!0),b+4},d.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):F(this,a,b,!1),b+4},d.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);D(this,a,b,c,e-1,-e)}var f=0,g=1,h=0>a?1:0;for(this[b]=255&a;++f<c&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},d.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);D(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0>a?1:0;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},d.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,1,127,-128),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=a,b+1},d.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):E(this,a,b,!0),b+2},d.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):E(this,a,b,!1),b+2},d.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):F(this,a,b,!0),b+4},d.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||D(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):F(this,a,b,!1),b+4},d.prototype.writeFloatLE=function(a,b,c){return H(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){return H(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){return I(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){return I(this,a,b,!1,c)},d.prototype.copy=function(a,b,c,e){if(c||(c=0),e||0===e||(e=this.length),b>=a.length&&(b=a.length),b||(b=0),e>0&&c>e&&(e=c),e===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>e)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length),a.length-b<e-c&&(e=a.length-b+c);var f=e-c;if(1e3>f||!d.TYPED_ARRAY_SUPPORT)for(var g=0;f>g;g++)a[g+b]=this[g+c];else a._set(this.subarray(c,c+f),b);return f},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");if(0>c||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=M(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},d.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(d.TYPED_ARRAY_SUPPORT)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var X=d.prototype;d._augment=function(a){return a.constructor=d,a._isBuffer=!0,a._set=a.set,a.get=X.get,a.set=X.set,a.write=X.write,a.toString=X.toString,a.toLocaleString=X.toString,a.toJSON=X.toJSON,a.equals=X.equals,a.compare=X.compare,a.indexOf=X.indexOf,a.copy=X.copy,a.slice=X.slice,a.readUIntLE=X.readUIntLE,a.readUIntBE=X.readUIntBE,a.readUInt8=X.readUInt8,a.readUInt16LE=X.readUInt16LE,a.readUInt16BE=X.readUInt16BE,a.readUInt32LE=X.readUInt32LE,a.readUInt32BE=X.readUInt32BE,a.readIntLE=X.readIntLE,a.readIntBE=X.readIntBE,a.readInt8=X.readInt8,a.readInt16LE=X.readInt16LE,a.readInt16BE=X.readInt16BE,a.readInt32LE=X.readInt32LE,a.readInt32BE=X.readInt32BE,a.readFloatLE=X.readFloatLE,a.readFloatBE=X.readFloatBE,a.readDoubleLE=X.readDoubleLE,a.readDoubleBE=X.readDoubleBE,a.writeUInt8=X.writeUInt8,a.writeUIntLE=X.writeUIntLE,a.writeUIntBE=X.writeUIntBE,a.writeUInt16LE=X.writeUInt16LE,a.writeUInt16BE=X.writeUInt16BE,a.writeUInt32LE=X.writeUInt32LE,a.writeUInt32BE=X.writeUInt32BE,a.writeIntLE=X.writeIntLE,a.writeIntBE=X.writeIntBE,a.writeInt8=X.writeInt8,a.writeInt16LE=X.writeInt16LE,a.writeInt16BE=X.writeInt16BE,a.writeInt32LE=X.writeInt32LE,a.writeInt32BE=X.writeInt32BE,a.writeFloatLE=X.writeFloatLE,a.writeFloatBE=X.writeFloatBE,a.writeDoubleLE=X.writeDoubleLE,a.writeDoubleBE=X.writeDoubleBE,a.fill=X.fill,a.inspect=X.inspect,a.toArrayBuffer=X.toArrayBuffer,a};var Y=/[^+\/0-9A-z\-]/g},{"base64-js":23,ieee754:24,"is-array":25}],23:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g||b===l?62:b===h||b===m?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0),l="-".charCodeAt(0),m="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],24:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],25:[function(a,b,c){var d=Array.isArray,e=Object.prototype.toString;b.exports=d||function(a){return!!a&&"[object Array]"==e.call(a)}},{}],26:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],27:[function(a,b,c){!function(){var a="js-websocket",c="0.0.1",d=window.Protocol,e=window.protobuf,f=window.decodeIO_protobuf,g=null,h=null,i=d.Package,j=d.Message,k=window.EventEmitter,l=window.rsa;"undefined"!=typeof window&&"undefined"!=typeof sys&&sys.localStorage&&(window.localStorage=sys.localStorage);var m=200,n=501;"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b});var o=window,p=Object.create(k.prototype);o.pomelo=p;var q,r=null,s=0,t={},u={},v={},w={},x={},y={},z={},A=0,B=0,C=0,D=0,E=100,F=null,G=null,H=null,I=null,J=null,K=!1,L=null,M=null,N=0,O=5e3,P=10,Q={sys:{type:a,version:c,rsa:{}},user:{}},R=null;p.init=function(a,b){R=b;var c=a.host,d=a.port;J=a.encode||T,I=a.decode||S;var e="ws://"+c;if(d&&(e+=":"+d),Q.user=a.user,a.encrypt){q=!0,l.generate(1024,"10001");var f={rsa_n:l.n.toString(16),rsa_e:l.e};Q.sys.rsa=f}H=a.handshakeCallback,U(a,e,b)};var S=p.decode=function(a){var b=j.decode(a);if(!(b.id>0)||(b.route=v[b.id],delete v[b.id],b.route))return b.body=da(b),b},T=p.encode=function(a,b,c){var f=a?j.TYPE_REQUEST:j.TYPE_NOTIFY;if(e&&z[b])c=e.encode(b,c);else if(g&&g.lookup(b)){var h=g.build(b);c=new h(c).encodeNB()}else c=d.strencode(JSON.stringify(c));var i=0;return w&&w[b]&&(b=w[b],i=1),j.encode(a,f,i,b,c)},U=function(a,b,c){console.log("connect to "+b);var a=a||{},j=a.maxReconnectAttempts||P;if(M=b,window.localStorage&&window.localStorage.getItem("protos")&&0===A){var k=JSON.parse(window.localStorage.getItem("protos"));A=k.version||0,y=k.server||{},z=k.client||{},e&&e.init({encoderProtos:z,decoderProtos:y}),f&&(g=f.loadJson(z),h=f.loadJson(y))}Q.sys.protoVersion=A;var l=function(a){K&&p.emit("reconnect"),V();var b=i.encode(i.TYPE_HANDSHAKE,d.strencode(JSON.stringify(Q)));X(b)},m=function(a){ba(i.decode(a.data),c),C&&(D=Date.now()+C)},n=function(a){p.emit("io-error",a),console.error("socket error: ",a)},o=function(b){p.emit("close",b),p.emit("disconnect",b),console.error("socket close: ",b),a.reconnect&&j>N&&(K=!0,N++,L=setTimeout(function(){U(a,M,c)},O),O*=2)};r=new WebSocket(b),r.binaryType="arraybuffer",r.onopen=l,r.onmessage=m,r.onerror=n,r.onclose=o};p.disconnect=function(){r&&(r.disconnect&&r.disconnect(),r.close&&r.close(),console.log("disconnect"),r=null),F&&(clearTimeout(F),F=null),G&&(clearTimeout(G),G=null)};var V=function(){K=!1,O=5e3,N=0,clearTimeout(L)};p.request=function(a,b,c){2===arguments.length&&"function"==typeof b?(c=b,b={}):b=b||{},a=a||b.route,a&&(s++,W(s,a,b),t[s]=c,v[s]=a)},p.notify=function(a,b){b=b||{},W(0,a,b)};var W=function(a,b,c){if(q){c=JSON.stringify(c);var d=l.signString(c,"sha256");c=JSON.parse(c),c.__crypto__=d}J&&(c=J(a,b,c));var e=i.encode(i.TYPE_DATA,c);X(e)},X=function(a){r&&r.send(a.buffer)},Y=function(a){if(B){var b=i.encode(i.TYPE_HEARTBEAT);G&&(clearTimeout(G),G=null),F||(F=setTimeout(function(){F=null,X(b),D=Date.now()+C,G=setTimeout(Z,C)},B))}},Z=function(){var a=D-Date.now();a>E?G=setTimeout(Z,a):(console.error("server heartbeat timeout"),p.emit("heartbeat timeout"),p.disconnect())},$=function(a){if(a=JSON.parse(d.strdecode(a)),a.code===n)return void p.emit("error","client version not fullfill");if(a.code!==m)return void p.emit("error","handshake fail");ea(a);var b=i.encode(i.TYPE_HANDSHAKE_ACK);X(b),R&&R(r)},_=function(a){var b=a;I&&(b=I(b)),ca(p,b)},aa=function(a){a=JSON.parse(d.strdecode(a)),p.emit("onKick",a)};u[i.TYPE_HANDSHAKE]=$,u[i.TYPE_HEARTBEAT]=Y,u[i.TYPE_DATA]=_,u[i.TYPE_KICK]=aa;var ba=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++){var c=a[b];u[c.type](c.body)}else u[a.type](a.body)},ca=function(a,b){if(!b.id)return void a.emit(b.route,b.body);var c=t[b.id];delete t[b.id],"function"==typeof c&&c(b.body)},da=function(a){var b=a.route;if(a.compressRoute){if(!x[b])return{};b=a.route=x[b]}return e&&y[b]?e.decodeStr(b,a.body):h&&h.lookup(b)?h.build(b).decode(a.body):JSON.parse(d.strdecode(a.body))},ea=function(a){a.sys&&a.sys.heartbeat?(B=1e3*a.sys.heartbeat,C=2*B):(B=0,C=0),fa(a),"function"==typeof H&&H(a.user)},fa=function(a){if(a&&a.sys){w=a.sys.dict;var b=a.sys.protos;if(w){w=w,x={};for(var c in w)x[w[c]]=c}b&&(A=b.version||0,y=b.server||{},z=b.client||{},window.localStorage.setItem("protos",JSON.stringify(b)),e&&e.init({encoderProtos:b.client,decoderProtos:b.server}),f&&(g=f.loadJson(z),h=f.loadJson(y)))}};b.exports=p}()},{}],28:[function(a,b,c){var d=b.exports;d.encodeUInt32=function(a){var b=parseInt(a);if(isNaN(b)||0>b)return console.log(b),null;var c=[];do{var d=b%128,e=Math.floor(b/128);0!==e&&(d+=128),c.push(d),b=e}while(0!==b);return c},d.encodeSInt32=function(a){var b=parseInt(a);return isNaN(b)?null:(b=0>b?2*Math.abs(b)-1:2*b,d.encodeUInt32(b))},d.decodeUInt32=function(a){for(var b=0,c=0;c<a.length;c++){var d=parseInt(a[c]);if(b+=(127&d)*Math.pow(2,7*c),128>d)return b}return b},d.decodeSInt32=function(a){var b=this.decodeUInt32(a),c=b%2===1?-1:1;return b=(b%2+b)/2*c}},{}],29:[function(a,b,c){b.exports={TYPES:{uInt32:0,sInt32:0,int32:0,"double":1,string:2,message:2,"float":5}}},{}],30:[function(a,b,c){function d(a,b,c){for(;c>m;){var d=e(),h=(d.type,d.tag),i=b.__tags[h];switch(b[i].option){case"optional":case"required":a[i]=f(b[i].type,b);break;case"repeated":a[i]||(a[i]=[]),g(a[i],b[i].type,b)}}return a}function e(){var a=j.decodeUInt32(h());return{type:7&a,tag:a>>3}}function f(a,b){switch(a){case"uInt32":return j.decodeUInt32(h());case"int32":case"sInt32":return j.decodeSInt32(h());case"float":var c=i.readFloatLE(m);return m+=4,c;case"double":var e=i.readDoubleLE(m);return m+=8,e;case"string":var f=j.decodeUInt32(h()),g=i.toString("utf8",m,m+f);return m+=f,g;default:var k=b&&(b.__messages[a]||l.protos["message "+a]);if(k){var f=j.decodeUInt32(h()),n={};return d(n,k,m+f),n}}}function g(a,b,c){if(k.isSimpleType(b))for(var d=j.decodeUInt32(h()),e=0;d>e;e++)a.push(f(b));else a.push(f(b,c))}function h(a){var b=[],c=m;a=a||!1;var d;do{var d=i.readUInt8(c);b.push(d),c++}while(d>=128);return a||(m=c),b}var i,j=a("./codec"),k=a("./util"),l=b.exports,m=0;l.init=function(a){this.protos=a||{}},l.setProtos=function(a){a&&(this.protos=a)},l.decode=function(a,b){var c=this.protos[a];return i=b,m=0,c?d({},c,i.length):null}},{"./codec":28,"./util":34}],31:[function(a,b,c){(function(c){function d(a,b){if(!b||!a)return console.warn("no protos or msg exist! msg : %j, protos : %j",a,b),!1;for(var c in b){var e=b[c];switch(e.option){case"required":if("undefined"==typeof a[c])return console.warn("no property exist for required! name: %j, proto: %j, msg: %j",c,e,a),!1;case"optional":if("undefined"!=typeof a[c]){var f=b.__messages[e.type]||m.protos["message "+e.type];if(f&&!d(a[c],f))return console.warn("inner proto error! name: %j, proto: %j, msg: %j",c,e,a),!1}break;case"repeated":var f=b.__messages[e.type]||m.protos["message "+e.type];if(a[c]&&f)for(var g=0;g<a[c].length;g++)if(!d(a[c][g],f))return!1}}return!0}function e(a,b,c,d){for(var e in d)if(c[e]){var j=c[e];switch(j.option){case"required":case"optional":b=h(a,b,i(j.type,j.tag)),b=f(d[e],j.type,b,a,c);break;case"repeated":d[e]&&d[e].length>0&&(b=g(d[e],j,b,a,c))}}return b}function f(a,b,d,f,g){var i=0;switch(b){case"uInt32":d=h(f,d,j.encodeUInt32(a));break;case"int32":case"sInt32":d=h(f,d,j.encodeSInt32(a));break;case"float":f.writeFloatLE(a,d),d+=4;break;case"double":f.writeDoubleLE(a,d),d+=8;break;case"string":i=c.byteLength(a),d=h(f,d,j.encodeUInt32(i)),f.write(a,d,i),d+=i;break;default:var k=g.__messages[b]||m.protos["message "+b];if(k){var l=new c(2*c.byteLength(JSON.stringify(a)));i=0,i=e(l,i,k,a),d=h(f,d,j.encodeUInt32(i)),l.copy(f,d,0,i),d+=i}}return d}function g(a,b,c,d,e){var g=0;if(l.isSimpleType(b.type))for(c=h(d,c,i(b.type,b.tag)),c=h(d,c,j.encodeUInt32(a.length)),g=0;g<a.length;g++)c=f(a[g],b.type,c,d);else for(g=0;g<a.length;g++)c=h(d,c,i(b.type,b.tag)),c=f(a[g],b.type,c,d,e);return c}function h(a,b,c){for(var d=0;d<c.length;d++)a.writeUInt8(c[d],b),b++;return b}function i(a,b){var c=k.TYPES[a];return void 0===c&&(c=2),j.encodeUInt32(b<<3|c)}var j=a("./codec"),k=a("./constant"),l=a("./util"),m=b.exports;m.init=function(a){this.protos=a||{}},m.encode=function(a,b){if(!a||!b)return console.warn("Route or msg can not be null! route : %j, msg %j",a,b),null;var f=this.protos[a];if(!d(b,f))return console.warn("check msg failed! msg : %j, proto : %j",b,f),null;var g=2*c.byteLength(JSON.stringify(b)),h=new c(g),i=0;return f&&(i=e(h,i,f,b),i>0)?h.slice(0,i):null}}).call(this,a("buffer").Buffer)},{"./codec":28,"./constant":29,"./util":34,buffer:22}],32:[function(a,b,c){function d(a){var b={},c={},e={};for(var f in a){var g=a[f],h=f.split(" ");switch(h[0]){case"message":if(2!==h.length)continue;c[h[1]]=d(g);continue;case"required":case"optional":case"repeated":if(3!==h.length||e[g])continue;b[h[2]]={option:h[0],type:h[1],tag:g},e[g]=h[2]}}return b.__messages=c,b.__tags=e,b}var e=b.exports;e.parse=function(a){var b={};for(var c in a)b[c]=d(a[c]);return b}},{}],33:[function(a,b,c){(function(c){var d=a("./encoder"),e=a("./decoder"),f=a("./parser"),g=b.exports;g.encode=function(a,b){return d.encode(a,b)},g.encode2Bytes=function(a,b){
var c=this.encode(a,b);if(!c||!c.length)return console.warn("encode msg failed! key : %j, msg : %j",a,b),null;for(var d=new Uint8Array(c.length),e=0;e<c.length;e++)d[e]=c.readUInt8(e);return d},g.encodeStr=function(a,b,c){c=c||"base64";var d=g.encode(a,b);return d?d.toString(c):d},g.decode=function(a,b){return e.decode(a,b)},g.decodeStr=function(a,b,d){d=d||"base64";var e=new c(b,d);return e?g.decode(a,e):e},g.parse=function(a){return f.parse(a)},g.setEncoderProtos=function(a){d.init(a)},g.setDecoderProtos=function(a){e.init(a)},g.init=function(a){d.init(a.encoderProtos),e.init(a.decoderProtos)}}).call(this,a("buffer").Buffer)},{"./decoder":30,"./encoder":31,"./parser":32,buffer:22}],34:[function(a,b,c){var d=b.exports;d.isSimpleType=function(a){return"uInt32"===a||"sInt32"===a||"int32"===a||"uInt64"===a||"sInt64"===a||"float"===a||"double"===a},d.equal=function(a,b){for(var c in a){var e=a[c],f=b[c];if("object"==typeof e){if(!d.equal(e,f))return!1}else if(e!==f)return!1}return!0}},{}],35:[function(a,b,c){b.exports=a("./lib/protocol")},{"./lib/protocol":36}],36:[function(a,b,c){(function(a){!function(c,d,e){var f=c,g=4,h=1,i=2,j=1,k=65535,l=1,m=7,n=f.Package={},o=f.Message={};n.TYPE_HANDSHAKE=1,n.TYPE_HANDSHAKE_ACK=2,n.TYPE_HEARTBEAT=3,n.TYPE_DATA=4,n.TYPE_KICK=5,o.TYPE_REQUEST=0,o.TYPE_NOTIFY=1,o.TYPE_RESPONSE=2,o.TYPE_PUSH=3,f.strencode=function(b){if("undefined"!=typeof a&&d===a)return new a(b);for(var c=new d(3*b.length),e=0,f=0;f<b.length;f++){var g=b.charCodeAt(f),h=null;h=127>=g?[g]:2047>=g?[192|g>>6,128|63&g]:[224|g>>12,128|(4032&g)>>6,128|63&g];for(var i=0;i<h.length;i++)c[e]=h[i],++e}var j=new d(e);return p(j,0,c,0,e),j},f.strdecode=function(b){if("undefined"!=typeof a&&d===a)return b.toString();for(var c=new d(b),e=[],f=0,g=0,h=c.length;h>f;)c[f]<128?(g=c[f],f+=1):c[f]<224?(g=((31&c[f])<<6)+(63&c[f+1]),f+=2):(g=((15&c[f])<<12)+((63&c[f+1])<<6)+(63&c[f+2]),f+=3),e.push(g);return String.fromCharCode.apply(null,e)},n.encode=function(a,b){var c=b?b.length:0,e=new d(g+c),f=0;return e[f++]=255&a,e[f++]=c>>16&255,e[f++]=c>>8&255,e[f++]=255&c,b&&p(e,f,b,0,c),e},n.decode=function(a){for(var b=0,c=new d(a),e=0,f=[];b<c.length;){var g=c[b++];e=(c[b++]<<16|c[b++]<<8|c[b++])>>>0;var h=e?new d(e):null;h&&p(h,0,c,b,e),b+=e,f.push({type:g,body:h})}return 1===f.length?f[0]:f},o.encode=function(a,b,c,e,g){var k=q(b)?s(a):0,l=h+k;if(r(b))if(c){if("number"!=typeof e)throw new Error("error flag for number route!");l+=i}else if(l+=j,e){if(e=f.strencode(e),e.length>255)throw new Error("route maxlength is overflow");l+=e.length}g&&(l+=g.length);var m=new d(l),n=0;return n=t(b,c,m,n),q(b)&&(n=u(a,m,n)),r(b)&&(n=v(c,e,m,n)),g&&(n=w(g,m,n)),m},o.decode=function(a){var b=new d(a),c=b.length||b.byteLength,e=0,g=0,h=null,i=b[e++],j=i&l,k=i>>1&m;if(q(k)){var n=0,o=0;do n=parseInt(b[e]),g+=(127&n)<<7*o,e++,o++;while(n>=128)}if(r(k))if(j)h=b[e++]<<8|b[e++];else{var s=b[e++];s?(h=new d(s),p(h,0,b,e,s),h=f.strdecode(h)):h="",e+=s}var t=c-e,u=new d(t);return p(u,0,b,e,t),{id:g,type:k,compressRoute:j,route:h,body:u}};var p=function(a,b,c,d,e){if("function"==typeof c.copy)c.copy(a,b,d,d+e);else for(var f=0;e>f;f++)a[b++]=c[d++]},q=function(a){return a===o.TYPE_REQUEST||a===o.TYPE_RESPONSE},r=function(a){return a===o.TYPE_REQUEST||a===o.TYPE_NOTIFY||a===o.TYPE_PUSH},s=function(a){var b=0;do b+=1,a>>=7;while(a>0);return b},t=function(a,b,c,d){if(a!==o.TYPE_REQUEST&&a!==o.TYPE_NOTIFY&&a!==o.TYPE_RESPONSE&&a!==o.TYPE_PUSH)throw new Error("unkonw message type: "+a);return c[d]=a<<1|(b?1:0),d+h},u=function(a,b,c){do{var d=a%128,e=Math.floor(a/128);0!==e&&(d+=128),b[c++]=d,a=e}while(0!==a);return c},v=function(a,b,c,d){if(a){if(b>k)throw new Error("route number is overflow");c[d++]=b>>8&255,c[d++]=255&b}else b?(c[d++]=255&b.length,p(c,d,b,0,b.length),d+=b.length):c[d++]=0;return d},w=function(a,b,c){return p(b,c,a,0,a.length),c+a.length};b.exports=f,"undefined"!=typeof window&&(window.Protocol=f)}("undefined"==typeof window?b.exports:this.Protocol={},"undefined"==typeof window?a:Uint8Array,this)}).call(this,a("buffer").Buffer)},{buffer:22}]},{},[1]);